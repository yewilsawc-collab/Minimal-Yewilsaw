<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messaging Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <!-- Firebase config -->
  <script id="firebase-config" type="application/json">
  {
  "apiKey": "AIzaSyB9fmgduk-bcSRTPL6FdcKKgqvTtQoICpE",
    "authDomain": "university-outreach-log.firebaseapp.com",
    "projectId": "university-outreach-log",
    "storageBucket": "university-outreach-log.firebasestorage.app",
    "messagingSenderId": "566149647802",
    "appId": "1:566149647802:web:490c7cc3d10b7cd7732183"
  }
  </script>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col">

  <!-- Header -->
  <header class="p-4 flex justify-between items-center bg-slate-800">
    <h1 class="text-xs font-black text-blue-400 uppercase">Messaging Pro</h1>
    <div class="flex gap-2">
      <button onclick="window.switchAccount()" class="bg-slate-700 px-3 py-1.5 rounded-lg text-[9px] font-black uppercase">Switch Account</button>
      <button id="logout-btn" onclick="window.processLogout()" class="hidden bg-slate-600 px-3 py-1.5 rounded-lg text-[9px] font-black uppercase">Logout</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="flex border-b border-slate-700">
    <button onclick="window.switchTab('advisor')" id="tab-advisor" class="flex-1 py-3 text-[10px] font-black uppercase border-b-2 border-blue-500 text-blue-400">Advisor</button>
    <button onclick="window.switchTab('groups')" id="tab-groups" class="flex-1 py-3 text-[10px] font-black uppercase border-b-2 border-transparent text-slate-500">Groups</button>
    <button onclick="window.switchTab('direct')" id="tab-direct" class="flex-1 py-3 text-[10px] font-black uppercase border-b-2 border-transparent text-slate-500">Direct</button>
    <button onclick="window.switchTab('docs')" id="tab-docs" class="flex-1 py-3 text-[10px] font-black uppercase border-b-2 border-transparent text-slate-500">Docs</button>
    <button onclick="window.switchTab('vault')" id="tab-vault" class="flex-1 py-3 text-[10px] font-black uppercase border-b-2 border-transparent text-slate-500">Vault</button>
  </nav>

  <!-- Main -->
  <main id="swipe-zone" class="flex-1 p-4 pb-40 max-w-2xl mx-auto w-full">

    <!-- Advisor Chat -->
    <div id="advisor-view" class="space-y-4"></div>

    <!-- Group Threads -->
    <div id="groups-view" class="hidden space-y-4"></div>

    <!-- Direct (PTP) Threads -->
    <div id="direct-view" class="hidden space-y-4">
      <div id="thread-list" class="space-y-2"></div>
      <div id="direct-chat" class="hidden space-y-4"></div>
    </div>

    <!-- Docs -->
    <div id="docs-view" class="hidden space-y-4">
      <input type="file" id="file-upload-input" class="hidden" onchange="window.handleFileUpload(event)" />
      <button onclick="document.getElementById('file-upload-input').click()" class="bg-blue-600 px-4 py-2 rounded-lg text-xs font-bold uppercase">Upload Document</button>
      <div id="file-list" class="space-y-2"></div>
    </div>

    <!-- Vault -->
    <div id="vault-view" class="hidden space-y-4">
      <div id="vault-editor"></div>
      <button onclick="window.saveVault()" class="w-full py-3 bg-blue-600 text-white text-[10px] font-black uppercase rounded-xl">Save Vault</button>
    </div>
  </main>

  <!-- Footer Chat -->
  <footer class="fixed bottom-0 left-0 right-0 p-4 bg-slate-800">
    <form id="chat-form" class="relative max-w-md mx-auto">
      <input id="chat-input" type="text" placeholder="Message..." 
        class="w-full bg-slate-700 border border-slate-600 rounded-2xl py-4 pl-12 pr-14 text-sm text-white focus:ring-2 focus:ring-blue-500 outline-none" />
      
      <!-- Upload button inside input -->
      <button type="button" onclick="document.getElementById('chat-file-input').click()" 
        class="absolute left-2 top-1/2 -translate-y-1/2 text-blue-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M12 5v14M5 12h14"/>
        </svg>
      </button>
      
      <!-- Send button -->
      <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 p-2.5 rounded-xl text-white">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
      
      <input type="file" id="chat-file-input" class="hidden" onchange="window.handleFileUpload(event)" />
    </form>
  </footer>

  <!-- Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    import { getFirestore, doc, deleteDoc, collection, onSnapshot, query, orderBy, addDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL, listAll, deleteObject } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";

    const config = JSON.parse(document.getElementById("firebase-config").textContent);
    const app = initializeApp(config);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Switch tabs
    const tabs = ["advisor","groups","direct","docs","vault"];
    window.switchTab = (tab) => {
      tabs.forEach(t => {
        document.getElementById(`${t}-view`)?.classList.add("hidden");
        document.getElementById(`tab-${t}`).classList.replace("text-blue-400","text-slate-500");
        document.getElementById(`tab-${t}`).classList.replace("border-blue-500","border-transparent");
      });
      document.getElementById(`${tab}-view`)?.classList.remove("hidden");
      document.getElementById(`tab-${tab}`).classList.replace("text-slate-500","text-blue-400");
      document.getElementById(`tab-${tab}`).classList.replace("border-transparent","border-blue-500");
    };

    // Switch account
    window.switchAccount = async () => {
      await signOut(auth);
      alert("Signed out. Please sign in with another account.");
    };

    // Delete chat message
    window.deleteChat = async (id, collectionName="global_chat") => {
      await deleteDoc(doc(db, collectionName, id));
    };

    // Handle file upload
    window.handleFileUpload = async (e) => {
      const file = e.target.files?.[0];
      if (!file || !auth.currentUser) return;
      const fileRef = sRef(storage, `users/${auth.currentUser.uid}/docs/${Date.now()}_${file.name}`);
      await uploadBytes(fileRef, file);
      alert("âœ… File uploaded successfully.");
    };

    // TODO: Add sync functions for advisor, groups, direct threads
  </script>
</body>
</html>
